# Решение ошибки 1101 Cloudflare

## Проблема
Ошибка 1101 в Cloudflare возникает, когда Cloudflare не может найти файл `index.html` для обработки корневого запроса (`/`).

## Решение

### 1. Добавлен файл `index.html` в корень проекта
Создан файл `index.html` в корне проекта, который:
- Содержит базовую HTML структуру
- Перенаправляет пользователя на `/app` (основное приложение)
- Имеет правильные заголовки для предотвращения кэширования

### 2. Модифицирован `src/worker.js`
Добавлена обработка корневого запроса:
- При запросе `/` или `/index.html` возвращается HTML страница
- Добавлены правильные заголовки для предотвращения кэширования
- Сохранена логика кэширования для статических файлов

### 3. Обновлен файл `_redirects`
Добавлены правила:
- `/ /index.html 200` - явное указание для корневого пути
- `/_next/* /_next/* 200` - обработка Next.js статических файлов
- `/public/* /public/* 200` - обработка публичных файлов

### 4. Обновлен файл `_headers`
Добавлены специальные заголовки для корневого пути:
- `Cache-Control: no-cache, no-store, must-revalidate`
- `Content-Type: text/html; charset=utf-8`

### 5. Созданы Cloudflare Pages Functions

#### `functions/_middleware.js`
Middleware функция, которая:
- Добавляет security headers ко всем ответам
- Устанавливает правильные заголовки кэширования для HTML файлов

#### `functions/[[path]]/index.js`
Функция для обработки всех маршрутов:
- Обрабатывает корневой путь (`/`)
- Обрабатывает все остальные маршруты (кроме статических файлов)
- Возвращает `index.html` для SPA маршрутизации

## Как это работает

1. **Корневой запрос (`/`)**: 
   - Cloudflare Pages Function перехватывает запрос
   - Возвращает HTML страницу с редиректом на `/app`

2. **Статические файлы**:
   - Обрабатываются обычным образом
   - Кэшируются согласно настройкам

3. **SPA маршруты**:
   - Все остальные маршруты возвращают `index.html`
   - Клиентская маршрутизация обрабатывает дальнейшую навигацию

## Развертывание

1. Убедитесь, что все файлы добавлены в репозиторий
2. Запустите сборку: `pnpm run build`
3. Разверните на Cloudflare Pages
4. Проверьте, что корневой путь (`/`) работает корректно

## Проверка

После развертывания проверьте:
- `https://yourdomain.com/` - должен показывать загрузочную страницу
- `https://yourdomain.com/app` - основное приложение
- Статические файлы должны загружаться корректно
- Ошибка 1101 больше не должна появляться
